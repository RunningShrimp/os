# NOS Clippy Linting Configuration

# Lint级别
level = "warn"

# 允许的lint
allow = [
    # 允许某些在内核开发中常见的模式
    "dead_code",               # 可能有未使用的代码在内核中
    "unused_variables",        # 临时变量可能未使用
    "unused_imports",           # 导入但未使用的模块
    "unused_mut",               # 未使用的可变引用
    "missing_debug_implementations", # 某些结构体可能不需要Debug实现
    "missing_docs",            # 非公共API可能不需要文档
    "non_upper_case_globals",   # 某些常量使用小写
    "too_many_arguments",       # 某些函数需要多个参数
    "too_many_lines",           # 某些函数比较长
    "type_complexity",          # 某些类型比较复杂
    "cyclomatic_complexity",    # 某些函数逻辑复杂
    "needless_range_loop",      # 明确的循环可能更清晰
    "explicit_iter_loop",      # 显式的迭代器可能更清晰
    "iter_nth_zero",           # 使用iter().nth(0)可能更清晰
    "len_without_is_empty",     # len() != 0 可能比 !is_empty() 更清晰
    "while_let_on_iterator",   # while let在某些情况下更合适
    "cast_lossless",            # 某些类型转换是必要的
    "cast_possible_truncation", # 某些类型转换是安全的
    "cast_sign_loss",           # 某些符号转换是必要的
    "cast_precision_loss",      # 某些精度损失是可接受的
    "int_plus_one",             # x + 1 可能比 x += 1 更清晰
    "identity_op",              # x == x 用于某些检查
    "eq_op",                    # 某些等于操作是必要的
    "comparison_to_empty",      # 与空字符串比较可能更明确
    "similar_names",            # 某些相似名称是可接受的
    "single_match",             # 单个match可能更清晰
    "redundant_pattern_matching", # 冗余的模式匹配可能更安全
    "wildcard_imports",         # 模块级别的通配导入可能可接受
    "type_repetition_in_bounds", # 边界中的类型重复可能更明确
    "uninlined_format_args",    # 某些格式化参数不需要内联
    "inherent_to_string",       # 转换为字符串在某些情况下是必要的
    "module_name_repetitions", # 模块名重复在某些情况下是可接受的
]

# 警告级别的lint
warn = [
    # 性能相关警告
    "large_enum_variant",
    "large_stack_arrays",
    "boxed_local",
    "fn_too_large",
    "mutex_atomic",
    "mutex_integer",
    "await_holding_lock",
    "manual_memcpy",
    "manual_slice_clone",

    # 错误处理警告
    "result_map_err_unit",
    "result_map_unit_fn",
    "option_map_unit_fn",
    "option_map_or_none",
    "option_unwrap_used",
    "result_unwrap_used",
    "expect_used",
    "panic",
    "unimplemented",
    "todo",

    # 内存安全警告
    "unused_ownership_mutable_refs",
    "drop_copy",
    "drop_ref",
    "for_loop_over_option",
    "for_loop_over_result",
    "for_loops_over_vec",
    "needless_collect",
    "needless_borrow",

    # 代码质量警告
    "cloned_instead_of_copied",
    "redundant_clone",
    "temporary_assignment",
    "let_and_return",
    "needless_return",
    "needless_lifetimes",
    " needless_lifetimes",
    " needless_borrowed_reference",
    "no_effect_underscore_binding",
    "semicolon_if_nothing_returned",

    # 风格警告
    "trivial_regex",
    "unicode_not_nfc",
    "unusual_byte_groupings",
    "vec_resize_to_zero",
    "write_literal_with_empty_string",

    # 并发警告
    "deprecated_cfg_attr",
    "empty_loop",
    "while_immutable_condition",
    "indexing_slicing",
    "out_of_bounds_indexing",
    "panic_in_result_fn",
    "panic_in_drop_fn",
    "await_holding_refcell_ref",

    # 文档警告
    "missing_errors_doc",
    "missing_panics_doc",
    "missing_crate_level_docs",
    "missing_example",
    "missing_safety_doc",

    # 测试警告
    "cognitive_complexity",
    "too_many_arguments",
    "too_many_lines",
    "multiple_crate_versions",
    "wildcard_dependencies",

    # 其他警告
    "must_use_candidate",
    "must_use_unit",
    "float_cmp",
    "cast_possible_wrap",
    "cast_abs_to_unsigned",
    "cast_ref_to_mut",
    "cast_ptr_as_ptr",
    "maybe_infinite_iter",
    "iter_cloned_collect",
    "self_named_constructors",
    "self_named_constructors",
    "missing_inline_in_public_items",
    "exhaustive_enums",
    "exhaustive_structs",
    "enum_glob_use",
    "pub_enum_variant_names",
    "pub_use",
    "reexport_private_items",
    "module_inception",
    "shadow_reuse",
    "shadow_same",
    "shadow_unrelated",
    "stable_sort_primitive",
    "non_send_fields_in_send_ty",
    "new_without_default",
    "into_iter_on_ref",
    "from_iter_instead_of_collect",
    "filter_map_next",
    "filter_map_identity",
    "filetype_is_file",
    "seek_from_current",
    "seek_from_start",
    "seek_from_end",
    "path_buf_push_overwrite",
    "option_option",
    "linkedlist",
    "mem_forget",
    "mem_replace_with_default",
    "mem_discriminant_non_enum",
    "option_expect_used",
    "result_expect_used",
    "get_unwrap",
    "string_extend_chars",
    "unnecessary_mut_passed",
    "unnecessary_sort_by",
    "unnecessary_to_owned",
    "unnecessary_join",
    "or_fun_call",
    "while_some",
    "range_minus_one",
    "range_plus_one",
    "range_zip_with_len",
    "reversed_empty_ranges",
    "iterator_step_by_zero",
    "sum_overflows",
    "suboptimal_flops",
    "swap_ptr_to_ref",
    "transmute_ptr_to_ptr",
    "cast_slice_different_sizes",
    "type_id_on_boxed",
    "unit_cmp",
    "unit_arg",
    "unit_hash",
    "invalid_ref",
    "invalid_null_ptr_usage",
    "deref_addrof",
    "drop_bounds",
    "forget_copy",
    "forget_ref",
    "moved_unit_value",
    "mut_from_ref",
    "transmute_float_to_int",
    "transmute_int_to_float",
    "transmute_int_to_char",
    "transmute_int_to_bool",
    "transmute_ptr_to_ref",
    "char_lit_as_u8",
    "invalid_atomic_ordering",
    "invalid_atomic_ordering",
    "atomic_ordering_fence",
    "atomic_ordering_invalid",
    "atomic_ordering_load",
    "atomic_ordering_store",
    "atomic_ordering_fence",
    "atomic_ordering_seqcst",
    "atomic_ordering_acq_rel",
    "atomic_ordering_acquire",
    "atomic_ordering_release",
    "atomic_ordering_relaxed",
    "atomic_ordering_volatile",
    "atomic_ordering_volatile_read",
    "atomic_ordering_volatile_write",
    "atomic_ordering_volatile_read_write",
    "atomic_ordering_fence_acq_rel",
    "atomic_ordering_fence_acquire",
    "atomic_ordering_fence_release",
    "atomic_ordering_fence_seqcst",
    "atomic_ordering_fence_volatile",
    "atomic_ordering_fence_volatile_read",
    "atomic_ordering_fence_volatile_write",
    "atomic_ordering_fence_volatile_read_write",
]

# 禁止的lint
deny = [
    "unsafe_code",           # 禁止unsafe代码（除非绝对必要）
    "macro_use_imports",     # 禁止use use ...;
    "unused_braces",         # 禁止不使用的代码块
    "unused_braces",         # 禁止不使用的代码块
    "unused_braces",         # 禁止不使用的代码块
]

# 特定模块的配置
[[warn]]
name = "kernel/*"
allow = ["dead_code"]

[[warn]]
name = "drivers/*"
allow = ["dead_code"]

[[warn]]
name = "arch/*"
allow = ["dead_code"]

[[warn]]
name = "tests/*"
allow = [
    "dead_code",
    "unused_variables",
    "unused_imports",
    "unused_mut",
]