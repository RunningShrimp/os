# Rust 操作系统内核项目 实施计划与 Todo

## 实施计划

* 目标与范围：基于 `kernel/user/xtask` 源码与构建配置，围绕功能完整性、POSIX 兼容、性能、可维护性与架构实践进行改进与验证。

* 方法与依据：系统化交叉检索源码与 Cargo 工作区；建立系统调用覆盖矩阵；设计 microbench 与 I/O/调度基准；在关键路径布置 trace 点与日志分级。

* 分阶段实施（短→中→长）：

  * 短期优先：系统调用清单与兼容性评估；日志分级与热路径优化； copyin/out 与内存分配优化；微基准与 I/O/调度基准落地；错误统一建模；工作区/crate 整理。

  * 中期推进：补齐 POSIX 信号与常用 syscalls；相对路径与文件系统语义一致性；网络栈基本功能与 socket 家族；SMP 并发与锁策略梳理；跨架构抽象统一。

  * 长期建设：架构取舍评估（单体/微内核边界）；驱动与设备管理完善；持续性能优化（调度/文件系统/网络）；文档与示例体系化完善。

* 关键技术路径：

  * 系统调用覆盖：生成清单，标注“覆盖/未实现/不一致”，为每项定义验收用例。

  * 性能优化：识别 O(N) 路径与频繁分配/拷贝；优化 copyin/out；对日志热路径做分级与采样；建立可复现实验脚本。

  * 维护性与分层：抽取公共 crate；统一错误模型与结果类型；规范目录与构建特性；完善文档与示例。

  * 并发与架构：SMP 与锁策略、CPU 亲和与调度器评估；统一跨架构接口层与隔离平台差异。

* 交付物与验收：

  * 报告类：系统调用覆盖矩阵、性能基线与优化报告、架构与并发策略说明、维护性重构记录。

  * 代码类：microbench 与 I/O/调度基准；日志分级与 trace 点；错误模型与公共 crate；copyin/out 与内存优化补丁；网络栈与 socket 初始实现。

  * 验收标准：覆盖率达标（POSIX 核心子集）、性能回归门槛明确、CI 稳定通过、文档完备可复现。

* 风险与保障：

  * 回归风险：引入基准与 CI 门槛；变更分支灰度合并。

  * 兼容性风险：以行为测试驱动接口对齐；必要时保留兼容层。

  * 资源风险：按优先级分批交付；以可拆分任务最小化阻塞。

## Todo 清单

* 建立系统调用清单并标注兼容性状态

* 添加 microbench 框架与 I/O/调度基准

* 引入日志分级并优化热路径

* 优化 copyin/copyout 与内存分配策略

* 统一错误建模与结果类型

* 整理工作区结构并抽取公共 crate

* 完善文件系统相对路径与语义一致性

* 补齐 POSIX 信号与核心 syscalls

* 初步实现网络栈与 socket 家族

* 梳理 SMP 并发与锁策略

* 统一跨架构抽象与接口层

* 完善文档与示例并提供复现实验脚本

